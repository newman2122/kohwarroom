<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KoH War Room â€” Enemy Activity Tracker</title>
  <link rel="stylesheet" href="css/theme.css" />
  <link rel="stylesheet" href="css/layout.css" />
  <link rel="stylesheet" href="css/components.css" />
  <link rel="stylesheet" href="css/components-ext.css" />
  <!-- Google Fonts for tactical feel -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
</head>
<body>
  <!-- Skip navigation for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <!-- Header -->
  <header class="war-room-header" role="banner">
    <div class="header-left">
      <h1 class="logo">
        <span class="logo-icon" aria-hidden="true">âš”ï¸</span>
        <span class="logo-text">KoH WAR ROOM</span>
      </h1>
      <p class="tagline">Enemy Activity Intelligence Dashboard</p>
    </div>
    <div class="header-right">
      <div class="tz-selector">
        <label for="viewer-timezone" class="sr-only">Your Timezone</label>
        <select id="viewer-timezone" aria-label="Select your timezone">
          <!-- Populated by JS -->
        </select>
        <span class="tz-clock" id="viewer-clock" aria-live="polite"></span>
      </div>
      <div class="user-badge" id="user-badge" aria-label="Your in-game username">
        <span class="user-badge-icon" aria-hidden="true">ğŸ®</span>
        <span class="user-badge-name" id="user-badge-name">Not Set</span>
      </div>
    </div>
  </header>

  <!-- Navigation Tabs -->
  <nav class="tab-nav" role="tablist" aria-label="Main navigation">
    <button class="tab-btn active" role="tab" aria-selected="true"
            aria-controls="panel-dashboard" id="tab-dashboard"
            data-tab="dashboard">ğŸ“Š Dashboard</button>
    <button class="tab-btn" role="tab" aria-selected="false"
            aria-controls="panel-activity" id="tab-activity"
            data-tab="activity">ğŸ” Activity Log</button>
    <button class="tab-btn" role="tab" aria-selected="false"
            aria-controls="panel-gather" id="tab-gather"
            data-tab="gather">â›ï¸ Gather Nodes</button>
    <button class="tab-btn" role="tab" aria-selected="false"
            aria-controls="panel-mobs" id="tab-mobs"
            data-tab="mobs">ğŸ‰ Mob Hits</button>
    <button class="tab-btn" role="tab" aria-selected="false"
            aria-controls="panel-intel" id="tab-intel"
            data-tab="intel">ğŸ“¡ Intel Summary</button>
    <button class="tab-btn" role="tab" aria-selected="false"
            aria-controls="panel-settings" id="tab-settings"
            data-tab="settings">âš™ï¸ Settings</button>
  </nav>

  <!-- Main Content -->
  <main id="main-content">
    <!-- DASHBOARD PANEL -->
    <section class="tab-panel active" id="panel-dashboard"
             role="tabpanel" aria-labelledby="tab-dashboard">
      <div class="dashboard-grid">
        <div class="stat-card" aria-label="Total sightings">
          <span class="stat-icon" aria-hidden="true">ğŸ‘ï¸</span>
          <span class="stat-value" id="stat-total-sightings">0</span>
          <span class="stat-label">Total Sightings</span>
        </div>
        <div class="stat-card" aria-label="Active enemies">
          <span class="stat-icon" aria-hidden="true">âš ï¸</span>
          <span class="stat-value" id="stat-active-enemies">0</span>
          <span class="stat-label">Unique Enemies</span>
        </div>
        <div class="stat-card" aria-label="Gather reports">
          <span class="stat-icon" aria-hidden="true">â›ï¸</span>
          <span class="stat-value" id="stat-gather-reports">0</span>
          <span class="stat-label">Gather Reports</span>
        </div>
        <div class="stat-card" aria-label="Mob hit reports">
          <span class="stat-icon" aria-hidden="true">ğŸ‰</span>
          <span class="stat-value" id="stat-mob-reports">0</span>
          <span class="stat-label">Mob Hit Reports</span>
        </div>
      </div>

      <div class="dashboard-charts">
        <div class="chart-card">
          <h2>Activity Heatmap (24hr)</h2>
          <div class="heatmap-container" id="activity-heatmap"
               role="img" aria-label="24-hour activity heatmap showing enemy activity by hour">
            <!-- Generated by JS -->
          </div>
        </div>
        <div class="chart-card">
          <h2>Recent Activity Feed</h2>
          <div class="activity-feed" id="recent-feed"
               role="log" aria-live="polite" aria-label="Recent enemy activity">
            <p class="empty-state">No activity logged yet. Start tracking!</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ACTIVITY LOG PANEL -->
    <section class="tab-panel" id="panel-activity"
             role="tabpanel" aria-labelledby="tab-activity" hidden>
      <div class="panel-header">
        <h2>ğŸ” Enemy Activity Log</h2>
        <p>Log when you spot an enemy player active in the game.</p>
      </div>
      <form class="entry-form" id="activity-form" aria-label="Log enemy activity">
        <div class="form-row">
          <div class="form-group">
            <label for="act-enemy-tag">Enemy Tag / Alias *</label>
            <input type="text" id="act-enemy-tag" required
                   placeholder="e.g. Target-Alpha, X-42"
                   aria-describedby="act-enemy-tag-help" />
            <small id="act-enemy-tag-help">Use a codename â€” never use real names!</small>
          </div>
          <div class="form-group">
            <label for="act-time">Time Spotted *</label>
            <input type="datetime-local" id="act-time" required
                   aria-describedby="act-time-help" />
            <small id="act-time-help">Time in YOUR selected timezone</small>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="act-type">Activity Type *</label>
            <select id="act-type" required>
              <option value="">â€” Select â€”</option>
              <option value="online">Came Online</option>
              <option value="gathering">Gathering Resources</option>
              <option value="mob-hunting">Hunting Mobs</option>
              <option value="rallying">Rallying</option>
              <option value="scouting">Scouting</option>
              <option value="attacking">Attacking Players</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="act-notes">Notes</label>
            <textarea id="act-notes" rows="2"
                      placeholder="Additional intelâ€¦"></textarea>
          </div>
        </div>
        <button type="submit" class="btn-primary">ğŸ“¡ Log Activity</button>
      </form>

      <div class="data-table-wrapper">
        <h3>Activity Log</h3>
        <div class="table-controls">
          <input type="text" id="activity-search" placeholder="Search logsâ€¦"
                 aria-label="Search activity logs" />
        </div>
        <table class="data-table" id="activity-table" aria-label="Enemy activity log">
          <thead>
            <tr>
              <th scope="col">Time (Your TZ)</th>
              <th scope="col">Enemy Tag</th>
              <th scope="col">Activity</th>
              <th scope="col">Notes</th>
              <th scope="col">Reported By</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody id="activity-tbody">
            <tr class="empty-row"><td colspan="6">No activity logged yet</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- GATHER NODES PANEL -->
    <section class="tab-panel" id="panel-gather"
             role="tabpanel" aria-labelledby="tab-gather" hidden>
      <div class="panel-header">
        <h2>â›ï¸ Gather Node Tracker</h2>
        <p>Track enemy players spotted on gather nodes (Levels 15â€“21).</p>
      </div>
      <form class="entry-form" id="gather-form" aria-label="Log gather node sighting">
        <div class="form-row">
          <div class="form-group">
            <label for="gath-enemy-tag">Enemy Tag / Alias *</label>
            <input type="text" id="gath-enemy-tag" required
                   placeholder="e.g. Target-Alpha" />
          </div>
          <div class="form-group">
            <label for="gath-time">Time Spotted *</label>
            <input type="datetime-local" id="gath-time" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="gath-node-level">Node Level *</label>
            <select id="gath-node-level" required>
              <option value="">â€” Select Level â€”</option>
              <option value="15">Level 15</option>
              <option value="16">Level 16</option>
              <option value="17">Level 17</option>
              <option value="18">Level 18</option>
              <option value="19">Level 19</option>
              <option value="20">Level 20</option>
              <option value="21">Level 21</option>
            </select>
          </div>
          <div class="form-group">
            <label for="gath-resource">Resource Type</label>
            <select id="gath-resource">
              <option value="">â€” Select â€”</option>
              <option value="food">ğŸŒ¾ Food</option>
              <option value="gold">ğŸ’° Gold</option>
              <option value="ore">â›ï¸ Ore</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="gath-coords">Coordinates</label>
            <input type="text" id="gath-coords"
                   placeholder="e.g. X:450 Y:320" />
          </div>
          <div class="form-group">
            <label for="gath-notes">Notes</label>
            <textarea id="gath-notes" rows="2"
                      placeholder="Shield timer, march size, etc."></textarea>
          </div>
        </div>
        <button type="submit" class="btn-primary">â›ï¸ Log Gather Sighting</button>
      </form>

      <div class="data-table-wrapper">
        <h3>Gather Node Log</h3>
        <div class="table-controls">
          <input type="text" id="gather-search" placeholder="Search gather logsâ€¦"
                 aria-label="Search gather logs" />
          <select id="gather-level-filter" aria-label="Filter by node level">
            <option value="">All Levels</option>
            <option value="15">Level 15</option>
            <option value="16">Level 16</option>
            <option value="17">Level 17</option>
            <option value="18">Level 18</option>
            <option value="19">Level 19</option>
            <option value="20">Level 20</option>
            <option value="21">Level 21</option>
          </select>
        </div>
        <table class="data-table" id="gather-table" aria-label="Gather node sightings">
          <thead>
            <tr>
              <th scope="col">Time (Your TZ)</th>
              <th scope="col">Enemy Tag</th>
              <th scope="col">Node Lvl</th>
              <th scope="col">Resource</th>
              <th scope="col">Coords</th>
              <th scope="col">Notes</th>
              <th scope="col">Reported By</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody id="gather-tbody">
            <tr class="empty-row"><td colspan="8">No gather sightings logged</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- MOB HITS PANEL -->
    <section class="tab-panel" id="panel-mobs"
             role="tabpanel" aria-labelledby="tab-mobs" hidden>
      <div class="panel-header">
        <h2>ğŸ‰ Mob Hit Tracker</h2>
        <p>Track enemy players hitting mobs for resources.</p>
      </div>
      <form class="entry-form" id="mob-form" aria-label="Log mob hit sighting">
        <div class="form-row">
          <div class="form-group">
            <label for="mob-enemy-tag">Enemy Tag / Alias *</label>
            <input type="text" id="mob-enemy-tag" required
                   placeholder="e.g. Target-Alpha" />
          </div>
          <div class="form-group">
            <label for="mob-time">Time Spotted *</label>
            <input type="datetime-local" id="mob-time" required />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="mob-level">Mob Level *</label>
            <input type="number" id="mob-level" required
                   min="1" max="100" placeholder="e.g. 35" />
          </div>
          <div class="form-group">
            <label for="mob-type">Mob Type</label>
            <select id="mob-type">
              <option value="">â€” Select â€”</option>
              <option value="goblin">ğŸ‘º Goblin</option>
              <option value="skeleton">ğŸ’€ Skeleton</option>
              <option value="treant">ğŸŒ³ Treant</option>
              <option value="raid">âš”ï¸ Raid Mob</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="mob-coords">Coordinates</label>
            <input type="text" id="mob-coords"
                   placeholder="e.g. X:120 Y:890" />
          </div>
          <div class="form-group">
            <label for="mob-notes">Notes</label>
            <textarea id="mob-notes" rows="2"
                      placeholder="March size, repeated hits, etc."></textarea>
          </div>
        </div>
        <button type="submit" class="btn-primary">ğŸ‰ Log Mob Hit</button>
      </form>

      <div class="data-table-wrapper">
        <h3>Mob Hit Log</h3>
        <div class="table-controls">
          <input type="text" id="mob-search" placeholder="Search mob logsâ€¦"
                 aria-label="Search mob hit logs" />
        </div>
        <table class="data-table" id="mob-table" aria-label="Mob hit sightings">
          <thead>
            <tr>
              <th scope="col">Time (Your TZ)</th>
              <th scope="col">Enemy Tag</th>
              <th scope="col">Mob Lvl</th>
              <th scope="col">Mob Type</th>
              <th scope="col">Coords</th>
              <th scope="col">Notes</th>
              <th scope="col">Reported By</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody id="mob-tbody">
            <tr class="empty-row"><td colspan="8">No mob hits logged</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- INTEL SUMMARY PANEL -->
    <section class="tab-panel" id="panel-intel"
             role="tabpanel" aria-labelledby="tab-intel" hidden>
      <div class="panel-header">
        <h2>ğŸ“¡ Intel Summary</h2>
        <p>Aggregated intelligence on enemy activity patterns.</p>
      </div>
      <div class="intel-grid">
        <div class="intel-card">
          <h3>ğŸ¯ Most Active Enemies</h3>
          <ol class="intel-list" id="intel-most-active">
            <li class="empty-state">No data yet</li>
          </ol>
        </div>
        <div class="intel-card">
          <h3>ğŸ• Peak Activity Hours</h3>
          <div class="peak-hours" id="intel-peak-hours">
            <p class="empty-state">No data yet</p>
          </div>
        </div>
        <div class="intel-card">
          <h3>â›ï¸ Preferred Gather Levels</h3>
          <div class="level-bars" id="intel-gather-levels">
            <p class="empty-state">No data yet</p>
          </div>
        </div>
        <div class="intel-card">
          <h3>ğŸ‰ Preferred Mob Levels</h3>
          <div class="level-bars" id="intel-mob-levels">
            <p class="empty-state">No data yet</p>
          </div>
        </div>
      </div>
      <div class="intel-card full-width">
        <h3>ğŸ“‹ Enemy Profiles</h3>
        <p>Select an enemy tag to see their full activity profile.</p>
        <div class="profile-controls">
          <label for="profile-enemy-select" class="sr-only">Select enemy</label>
          <select id="profile-enemy-select" aria-label="Select enemy for profile">
            <option value="">â€” Select Enemy â€”</option>
          </select>
        </div>
        <div id="enemy-profile-detail" class="profile-detail">
          <p class="empty-state">Select an enemy tag above to view profile.</p>
        </div>
      </div>
    </section>

    <!-- SETTINGS PANEL -->
    <section class="tab-panel" id="panel-settings"
             role="tabpanel" aria-labelledby="tab-settings" hidden>
      <div class="panel-header">
        <h2>âš™ï¸ Settings</h2>
        <p>Manage your profile and preferences.</p>
      </div>

      <div class="settings-section">
        <div class="entry-form">
          <h3 class="settings-heading">ğŸ® In-Game Username</h3>
          <p class="settings-desc">
            This is the name your clan mates see when you report intel.
            Update it here anytime you change your in-game name.
          </p>
          <form id="settings-username-form" aria-label="Update your username">
            <div class="form-row">
              <div class="form-group">
                <label for="settings-username">Current Username</label>
                <input type="text" id="settings-username" required
                       maxlength="30"
                       placeholder="Your in-game name"
                       aria-describedby="settings-username-help" />
                <small id="settings-username-help">
                  This is stored only on your device â€” no one else can see your real identity.
                </small>
              </div>
              <div class="form-group">
                <label for="settings-timezone">Your Timezone</label>
                <select id="settings-timezone" aria-label="Change your timezone">
                  <!-- Populated by JS -->
                </select>
              </div>
            </div>
            <button type="submit" class="btn-primary">ğŸ’¾ Save Settings</button>
          </form>
        </div>
      </div>

      <div class="settings-section">
        <div class="entry-form">
          <h3 class="settings-heading">ğŸ“ Username History</h3>
          <p class="settings-desc">
            If you change your in-game name, your old reports will still show
            the name you used when you filed them. This keeps the audit trail clean.
          </p>
          <div id="username-history" class="username-history">
            <p class="empty-state">No name changes recorded yet.</p>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <div class="entry-form">
          <h3 class="settings-heading">ğŸ›¡ï¸ Privacy Notice</h3>
          <p class="settings-desc">
            â€¢ Your username is stored <strong>only on your device</strong> (localStorage).<br>
            â€¢ Reports are submitted under your username â€” no email, no real name, no account.<br>
            â€¢ Enemy tags are codenames you assign â€” never use anyoneâ€™s real name.<br>
            â€¢ All shared data is synced via Firebase â€” free and anonymous.
          </p>
        </div>
      </div>
    </section>
  </main>

  <!-- Toast notification container -->
  <div id="toast-container" class="toast-container" aria-live="assertive" role="alert"></div>

  <!-- Welcome modal (first-time setup) -->
  <dialog id="welcome-dialog" class="welcome-dialog" aria-labelledby="welcome-title">
    <div class="welcome-content">
      <div class="welcome-icon" aria-hidden="true">âš”ï¸ğŸ‰</div>
      <h2 id="welcome-title">Welcome to the War Room</h2>
      <p class="welcome-subtitle">Before you start reporting intel, set up your profile.</p>
      <form id="welcome-form">
        <div class="form-group">
          <label for="welcome-username">ğŸ® Your In-Game Username *</label>
          <input type="text" id="welcome-username" required
                 maxlength="30"
                 placeholder="Enter your game nameâ€¦"
                 aria-describedby="welcome-username-help" />
          <small id="welcome-username-help">
            This is how your clan mates will see who reported intel.
            You can change it later in Settings.
          </small>
        </div>
        <div class="form-group">
          <label for="welcome-timezone">ğŸŒ Your Timezone *</label>
          <select id="welcome-timezone" required aria-label="Select your timezone">
            <!-- Populated by JS -->
          </select>
          <small>So we show you times in your local time.</small>
        </div>
        <button type="submit" class="btn-primary welcome-btn">ğŸš€ Enter the War Room</button>
      </form>
    </div>
  </dialog>

  <!-- Confirmation modal -->
  <dialog id="confirm-dialog" class="confirm-dialog" aria-labelledby="confirm-title">
    <h3 id="confirm-title">Confirm Action</h3>
    <p id="confirm-message"></p>
    <div class="dialog-buttons">
      <button class="btn-secondary" id="confirm-cancel">Cancel</button>
      <button class="btn-danger" id="confirm-ok">Confirm</button>
    </div>
  </dialog>

  <!-- Footer -->
  <footer class="war-room-footer" role="contentinfo">
    <p>KoH War Room â€” Data synced via Firebase. No real names are used or stored.</p>
    <p class="footer-note">ğŸ”’ Anonymous Intelligence Only</p>
  </footer>

  <!-- Firebase SDK (free tier) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <!-- JS Modules -->
  <script src="js/firebase-config.js"></script>
  <script src="js/timezone.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/dashboard.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
